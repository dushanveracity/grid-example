<div class="flex flex-col p-4">
  <div class="flex items-center justify-between px-6">
    <div class="flex items-center">
      <div class="flex items-center mx-1">
        <label for="X">Rows : </label>
        <input
          type="number"
          class="border p-1 w-12 rounded ml-1"
          [(ngModel)]="gridLayout.rows"
          [value]="gridLayout.rows"
          [disabled]="gridItems.length > 0"
        />
      </div>
      <div class="flex items-center mx-1">
        <label for="X">Cols : </label>
        <input
          type="number"
          class="border p-1 w-12 rounded ml-1"
          [(ngModel)]="gridLayout.cols"
          [value]="gridLayout.cols"
          [disabled]="gridItems.length > 0"
        />
      </div>
      <button
        [disabled]="gridItems.length"
        (click)="onGridSave($event)"
        class="py-1 px-2 rounded border mx-2 bg-blue-100"
      >
        Save
      </button>
    </div>
    <div>
      <select
        class="border px-2 py-1 rounded mx-1"
        (change)="changePanel($event)"
        [(ngModel)]="selectedPanel"
      >
        <option value="undefined">-Select-</option>
        <option *ngFor="let panel of panels" [value]="panel | json">
          {{ panel.model + " - " + panel.power + "W" }}
        </option>
      </select>
      <select
        class="border px-2 py-1 rounded mx-1"
        (change)="changeString($event)"
        [(ngModel)]="selectedString"
      >
        <option value="undefined">-Select-</option>
        <option *ngFor="let string of strings" [value]="string | json">
          {{ string.name }}
        </option>
      </select>
    </div>
  </div>
  <div
    (mousedown)="onMouseDown($event)"
    (mouseup)="onMouseUp($event)"
    class="p-6 gap-5 w-max"
    style="display: grid"
    [style.grid-template-columns]="gridLayoutStyle()"
  >
    <button
      *ngFor="let item of gridItems"
      class="py-1 px-2 border-2 rounded w-48 cursor-pointer duration-200 h-36 relative text-xs flex flex-col items-center justify-center"
      [ngClass]="{
        'border border-black bg-blue-50': this.selectedItems.includes(item.id)
      }"
      [style.background]="item.string?.color"
      (click)="onClick($event, item)"
      (mousemove)="onMouseMove(item)"
    >
      <div
        *ngIf="item.row === 1"
        class="absolute -top-6 left-16 flex flex-row items-center"
      >
        <button
          (click)="addColumnLeft(item.col)"
          class="w-5 h-5 text-xs rounded-full border"
        >
          &larr;
        </button>
        <button class="w-5 h-5 text-xs rounded-full border">-</button>
        <button
          (click)="addColumnRight(item.col)"
          class="w-5 h-5 text-xs rounded-full border"
        >
          &rarr;
        </button>
      </div>
      <div
        *ngIf="item.col === 1"
        class="absolute -left-6 top-10 flex flex-col items-center"
      >
        <button
          (click)="addRowAbove(item.row)"
          class="w-5 h-5 text-xs rounded-full border"
        >
          &uarr;
        </button>
        <button class="w-5 h-5 text-xs rounded-full border">-</button>
        <button
          (click)="addRowBelow(item.row)"
          class="w-5 h-5 text-xs rounded-full border"
        >
          &darr;
        </button>
      </div>
      <p class="font-semibold">{{ item.string?.name }}</p>
      <p class="font-semibold" *ngIf="item.panel">{{ item.panel?.model + ' - ' + item.panel?.power + 'W' }}</p>
    </button>
  </div>
</div>
